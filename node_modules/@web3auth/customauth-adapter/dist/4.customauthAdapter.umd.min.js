(window.webpackJsonpCustomauthAdapter=window.webpackJsonpCustomauthAdapter||[]).push([[4],{527:function(e,r,t){"use strict";t.d(r,"a",(function(){return p}));var n=t(485),i=t.n(n),a=t(590),s=t(6),o=t(535),c=t(530),d=t.n(c);function u(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function h(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?u(Object(t),!0).forEach((function(r){i()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class p extends a.a{constructor(e){let{config:r,state:t}=e;if(super({config:r,state:t}),i()(this,"_providerEngineProxy",null),!r.chainConfig)throw s.h.invalidProviderConfigError("Please provide chainConfig");if(!r.chainConfig.chainId)throw s.h.invalidProviderConfigError("Please provide chainId inside chainConfig");if(!r.chainConfig.rpcTarget)throw s.h.invalidProviderConfigError("Please provide rpcTarget inside chainConfig");this.defaultState={chainId:"loading"},this.defaultConfig={chainConfig:r.chainConfig,networks:{[r.chainConfig.chainId]:r.chainConfig}},super.initialize()}get provider(){return this._providerEngineProxy}set provider(e){throw new Error("Method not implemented.")}addChain(e){if(!e.chainId)throw o.ethErrors.rpc.invalidParams("chainId is required");if(!e.rpcTarget)throw o.ethErrors.rpc.invalidParams("chainId is required");this.configure({networks:h(h({},this.config.networks),{},{[e.chainId]:e})})}getChainConfig(e){var r;const t=null===(r=this.config.networks)||void 0===r?void 0:r[e];if(!t)throw o.ethErrors.rpc.invalidRequest("Chain ".concat(e," is not supported, please add chainConfig for it"));return t}getProviderEngineProxy(){return this._providerEngineProxy}updateProviderEngineProxy(e){this._providerEngineProxy?this._providerEngineProxy.setTarget(e):this._providerEngineProxy=Object(a.b)(e)}}d()()},593:function(e,r){},594:function(e,r){},603:function(e,r){},610:function(e,r){},621:function(e,r){},656:function(e,r){},658:function(e,r){},675:function(e,r){},683:function(e,r){},732:function(e,r){},809:function(e,r){},828:function(e,r){},979:function(e,r,t){"use strict";t.r(r),function(e){t.d(r,"PhantomInjectedProvider",(function(){return j})),t.d(r,"SolanaPrivateKeyProvider",(function(){return x})),t.d(r,"SolanaWallet",(function(){return T})),t.d(r,"TorusInjectedProvider",(function(){return A}));var n=t(495),i=t.n(n),a=t(655),s=t(563),o=t(6),c=t(527),d=t(807),u=t(539),h=t.n(u),p=t(586),g=t(827),l=t.n(g);function f(e){let{getAccounts:r}=e;return Object(s.c)(async(e,t,n)=>{const{method:i}=e;if("getAccounts"!==i)return n();if(!r)throw new Error("WalletMiddleware - opts.getAccounts not provided");const a=await r(e);t.result=a})}function m(e){let{requestAccounts:r}=e;return Object(s.c)(async(e,t,n)=>{const{method:i}=e;if("requestAccounts"!==i)return n();if(!r)throw new Error("WalletMiddleware - opts.requestAccounts not provided");const a=await r(e);t.result=a})}function v(e,r){return Object(s.c)(async(t,n,i)=>{const{method:a}=t;if(a!==e)return i();if(!r)throw new Error("WalletMiddleware - ".concat(e," not provided"));const s=await r(t);n.result=s})}function y(e){const{getAccounts:r,requestAccounts:t,signTransaction:n,signAndSendTransaction:i,signAllTransactions:a,signMessage:o,getPrivateKey:c}=e;return Object(s.e)([m({requestAccounts:t}),f({getAccounts:r}),v("signTransaction",n),v("signAndSendTransaction",i),v("signAllTransactions",a),v("signMessage",o),v("solanaPrivateKey",c)])}function w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function P(e){return Object(s.c)(async(r,t,n)=>{const a=await e.request(function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?w(Object(t),!0).forEach((function(r){i()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},r));t.result=a})}function O(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function b(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?O(Object(t),!0).forEach((function(r){i()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class j extends c.a{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:b(b({},r.chainConfig),{},{chainNamespace:o.f.SOLANA})},state:t})}async switchChain(e){return Promise.resolve()}async setupProvider(e){const r=y((e=>({requestAccounts:async()=>e.publicKey?[h.a.encode(e.publicKey.toBytes())]:[],getAccounts:async()=>e.publicKey?[h.a.encode(e.publicKey.toBytes())]:[],getPrivateKey:async()=>{throw p.ethErrors.rpc.methodNotSupported()},signTransaction:async r=>{const t=h.a.decode(r.params.message),n=d.c.from(t);return await e.signTransaction(n)},signMessage:async r=>{var t;return await e.request({method:"signMessage",params:{message:null===(t=r.params)||void 0===t?void 0:t.message}})},signAndSendTransaction:async r=>{const t=h.a.decode(r.params.message),n=d.c.from(t);return{signature:(await e.signAndSendTransaction(n)).signature}},signAllTransactions:async r=>{var t,n;if(null===(t=r.params)||void 0===t||!t.message||null===(n=r.params)||void 0===n||!n.message.length)throw p.ethErrors.rpc.invalidParams("message");const i=r.params.message.map(e=>{const r=h.a.decode(e);return d.c.from(r)});return await e.signAllTransactions(i)}}))(e)),t=P(e),n=new s.a;n.push(r),n.push(t);const i=Object(a.b)(n);this.updateProviderEngineProxy(i),await this.lookupNetwork(e)}async lookupNetwork(e){const{chainConfig:r}=this.config;return this.update({chainId:r.chainId}),r.chainId||""}}function E(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function C(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?E(Object(t),!0).forEach((function(r){i()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class A extends c.a{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:C(C({},r.chainConfig),{},{chainNamespace:o.f.SOLANA})},state:t})}async switchChain(e){return Promise.resolve()}async setupProvider(e){this.handleInjectedProviderUpdate(e),await this.setupEngine(e)}async lookupNetwork(){if(!this.provider)throw p.ethErrors.provider.custom({message:"Torus solana provider is not initialized",code:4902});const{chainId:e}=this.config.chainConfig,r=await this.provider.request({method:"solana_chainId"}),t=Object(o.k)(r.toString())?r:"0x".concat(parseInt(r,10).toString(16));if(e!==t)throw o.h.rpcConnectionError("Invalid network, net_version is: ".concat(t,", expected: ").concat(e));return this.update({chainId:t}),this.provider.emit("connect",{chainId:this.state.chainId}),this.provider.emit("chainChanged",this.state.chainId),this.state.chainId}async setupEngine(r){const t=y((r=>({requestAccounts:async()=>await r.request({method:"solana_requestAccounts",params:{}}),getAccounts:async()=>await r.request({method:"solana_accounts",params:{}}),getPrivateKey:async()=>{throw p.ethErrors.rpc.methodNotSupported()},signMessage:async e=>{var t;return await r.request({method:"sign_message",params:{data:null===(t=e.params)||void 0===t?void 0:t.message}})},signTransaction:async t=>{var n;if(null===(n=t.params)||void 0===n||!n.message)throw p.ethErrors.rpc.invalidParams("message");const i=h.a.decode(t.params.message).toString("hex"),a=await r.request({method:"sign_transaction",params:{message:i}}),s=e.from(a,"hex");return d.c.from(s)},signAndSendTransaction:async e=>{var t;if(null===(t=e.params)||void 0===t||!t.message)throw p.ethErrors.rpc.invalidParams("message");const n=h.a.decode(e.params.message).toString("hex");return{signature:await r.request({method:"send_transaction",params:{message:n}})}},signAllTransactions:async e=>{var t,n;if(null===(t=e.params)||void 0===t||!t.message||null===(n=e.params)||void 0===n||!n.message.length)throw p.ethErrors.rpc.invalidParams("message");const i=[];for(const r of e.params.message){const e=h.a.decode(r).toString("hex");i.push(e)}return await r.request({method:"sign_all_transactions",params:{message:i}})}}))(r)),n=P(r),i=new s.a;i.push(t),i.push(n);const o=Object(a.b)(i);this.updateProviderEngineProxy(o),await this.lookupNetwork()}async handleInjectedProviderUpdate(e){e.on("accountsChanged",async e=>{this.provider.emit("accountsChanged",e)}),e.on("chainChanged",async r=>{const t=Object(o.k)(r)?r:"0x".concat(parseInt(r,10).toString(16));this.configure({chainConfig:C(C({},this.config.chainConfig),{},{chainId:t})}),await this.setupProvider(e)})}}function S(e){return(r,t,n,i)=>"solana_chainId"===r.method?(t.result=e,i()):n()}function I(e){return(r,t,n,i)=>"solana_provider_config"===r.method?(t.result=e,i()):n()}function q(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function k(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?q(Object(t),!0).forEach((function(r){i()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class x extends c.a{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:k(k({},r.chainConfig),{},{chainNamespace:o.f.SOLANA})},state:t})}async enable(){if(!this.state.privateKey)throw p.ethErrors.provider.custom({message:"Private key is not found in state, plz pass it in constructor state param",code:4902});return await this.setupProvider(this.state.privateKey),this._providerEngineProxy.request({method:"eth_accounts"})}async setupProvider(r){const t=y(await async function(r){let{privKey:t,getProviderEngineProxy:n}=r;const i=e=>{const r=h.a.decode(e);return d.c.populate(d.b.from(r))};if("string"!=typeof t)throw o.h.invalidParams("privKey must be a string");const a=d.a.fromSecretKey(e.from(t,"hex"));return{requestAccounts:async()=>[a.publicKey.toBase58()],getAccounts:async()=>[a.publicKey.toBase58()],getPrivateKey:async()=>t,signTransaction:async e=>{var r,t;if(null===(r=e.params)||void 0===r||!r.message)throw p.ethErrors.rpc.invalidParams("message");const n=i(null===(t=e.params)||void 0===t?void 0:t.message);return n.partialSign(a),n},signMessage:async e=>{var r;if(null===(r=e.params)||void 0===r||!r.message)throw p.ethErrors.rpc.invalidParams("message");return l.a.sign.detached(e.params.message,a.secretKey)},signAndSendTransaction:async e=>{var r,t;if(null===(r=e.params)||void 0===r||!r.message)throw p.ethErrors.rpc.invalidParams("message");const s=n();if(!s)throw p.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const o=i(null===(t=e.params)||void 0===t?void 0:t.message);o.sign(a);return{signature:await s.request({method:"sendTransaction",params:[h.a.encode(o.serialize())]})}},signAllTransactions:async e=>{var r,t;if(null===(r=e.params)||void 0===r||!r.message||null===(t=e.params)||void 0===t||!t.message.length)throw p.ethErrors.rpc.invalidParams("message");const n=[];for(const r of(null===(s=e.params)||void 0===s?void 0:s.message)||[]){var s;const e=i(r);e.partialSign(a),n.push(e)}return n}}}({privKey:r,getProviderEngineProxy:this.getProviderEngineProxy.bind(this)})),n=new s.a,{networkMiddleware:i}=function(e){const{chainId:r,rpcTarget:t}=e,n=Object(a.a)({rpcTarget:t});return{networkMiddleware:Object(s.e)([S(r),I(e),n]),fetchMiddleware:n}}(this.config.chainConfig);n.push(this.getChainSwitchMiddleware()),n.push(this.getAccountMiddleware()),n.push(t),n.push(i);const c=Object(a.b)(n);this.updateProviderEngineProxy(c),await this.lookupNetwork()}async updateAccount(e){if(!this._providerEngineProxy)throw p.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});await this._providerEngineProxy.request({method:"solanaPrivateKey"})!==e.privateKey&&(await this.setupProvider(e.privateKey),this._providerEngineProxy.emit("accountsChanged",{accounts:await this._providerEngineProxy.request({method:"requestAccounts"})}))}async switchChain(e){if(!this._providerEngineProxy)throw p.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const r=this.getChainConfig(e.chainId);this.update({chainId:"loading"}),this.configure({chainConfig:r});const t=await this._providerEngineProxy.request({method:"solanaPrivateKey"});await this.setupProvider(t)}async lookupNetwork(){if(!this._providerEngineProxy)throw p.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const e=await this._providerEngineProxy.request({method:"getHealth",params:[]}),{chainConfig:r}=this.config;if("ok"!==e)throw o.h.rpcConnectionError("Failed to lookup network for following rpc target: ".concat(r.rpcTarget));return this.update({chainId:r.chainId}),this.state.chainId!==r.chainId&&(this.provider.emit("chainChanged",this.state.chainId),this.provider.emit("connect",{chainId:this.state.chainId})),this.state.chainId}getChainSwitchMiddleware(){return function(e){let{addNewChainConfig:r,switchSolanaChain:t}=e;return Object(s.e)([v("addSolanaChain",r),v("switchSolanaChain",t)])}({addNewChainConfig:async e=>{if(!e.params)throw p.ethErrors.rpc.invalidParams("Missing request params");const{chainId:r,chainName:t,rpcUrls:n,blockExplorerUrls:i,nativeCurrency:a}=e.params;if(!r)throw p.ethErrors.rpc.invalidParams("Missing chainId in chainParams");if(!n||0===n.length)throw p.ethErrors.rpc.invalidParams("Missing rpcUrls in chainParams");if(!a)throw p.ethErrors.rpc.invalidParams("Missing nativeCurrency in chainParams");this.addChain({chainNamespace:o.f.SOLANA,chainId:r,ticker:(null==a?void 0:a.symbol)||"SOL",tickerName:(null==a?void 0:a.name)||"Solana",displayName:t,rpcTarget:n[0],blockExplorer:(null==i?void 0:i[0])||""})},switchSolanaChain:async e=>{if(!e.params)throw p.ethErrors.rpc.invalidParams("Missing request params");if(!e.params.chainId)throw p.ethErrors.rpc.invalidParams("Missing chainId");await this.switchChain(e.params)}})}getAccountMiddleware(){return function(e){let{updatePrivatekey:r}=e;return Object(s.e)([v("updateAccount",r)])}({updatePrivatekey:async e=>{if(!e.params)throw p.ethErrors.rpc.invalidParams("Missing request params");if(!e.params.privateKey)throw p.ethErrors.rpc.invalidParams("Missing privateKey");const{privateKey:r}=e.params;await this.updateAccount({privateKey:r})}})}}i()(x,"getProviderInstance",async e=>{const r=new x({config:{chainConfig:e.chainConfig}});return await r.setupProvider(e.privKey),r});class T{constructor(e){i()(this,"provider",void 0),this.provider=e}async requestAccounts(){return await this.provider.request({method:"requestAccounts",params:{}})}async signAndSendTransaction(e){const{signature:r}=await this.provider.request({method:"signAndSendTransaction",params:{message:h.a.encode(e.serialize({requireAllSignatures:!1}))}});return{signature:r}}async signTransaction(e){return await this.provider.request({method:"signTransaction",params:{message:h.a.encode(e.serialize({requireAllSignatures:!1}))}})}async signAllTransactions(e){const r=e.map(e=>h.a.encode(e.serialize({requireAllSignatures:!1})));return await this.provider.request({method:"signAllTransactions",params:{message:r}})}async signMessage(e){return await this.provider.request({method:"signMessage",params:{message:e}})}async request(e){return await this.provider.request(e)}}}.call(this,t(3).Buffer)}}]);
//# sourceMappingURL=4.customauthAdapter.umd.min.js.map